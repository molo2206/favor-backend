// import { NestFactory } from '@nestjs/core';
// import { AppModule } from './app.module';
// import { NestExpressApplication } from '@nestjs/platform-express';
// import { join } from 'path';
// import * as bodyParser from 'body-parser';
// import { ValidationPipe } from '@nestjs/common';

// async function bootstrap() {
//   const app = await NestFactory.create<NestExpressApplication>(AppModule);

//   // Autoriser les requ√™tes cross-origin (ex: depuis localhost:5173)
//   app.enableCors({
//     origin: ['http://localhost:5173', 'https://favor-help.vercel.app'],
//     credentials: true,
//   });
//   // Autorise les corps JSON et urlencodeds
//   app.use(bodyParser.json({ limit: '10mb' }));
//   app.use(bodyParser.urlencoded({ extended: true, limit: '10mb' }));

//   // G√©rer les fichiers statiques (uploads/images etc.)
//   app.useStaticAssets(join(__dirname, '..', 'uploads/users'), {
//     prefix: '/uploads/users/',
//   });

//   // Pr√©fixe global pour tes routes
//   app.setGlobalPrefix('api/v1');
//   app.useGlobalPipes(
//     new ValidationPipe({
//       transform: true, // Permet la conversion automatique des types
//       whitelist: true, // Ignore les propri√©t√©s non d√©finies dans le DTO
//       forbidNonWhitelisted: true, // L√®ve une erreur si des propri√©t√©s non attendues sont envoy√©es
//     }),
//   );
//   await app.listen(3000);
// }
// bootstrap();
import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';
import { NestExpressApplication } from '@nestjs/platform-express';
import { join } from 'path';
import * as bodyParser from 'body-parser';
import { ValidationPipe } from '@nestjs/common';
import * as dotenv from 'dotenv';

// üîπ Charger les variables d'environnement d√®s le lancement
dotenv.config();
async function bootstrap() {
  const app = await NestFactory.create<NestExpressApplication>(AppModule);

  app.enableCors({
    origin: [
      'http://localhost:5173',
      'http://localhost:3000',
      'https://favor-privacy.vercel.app',
      'https://privacy.favorbusiness.com',
      'https://favor-help.vercel.app',
      'https://api-prod.favorbusiness.com'
    ],
    credentials: true,
  });

  app.use(bodyParser.json({ limit: '10mb' }));
  app.use(bodyParser.urlencoded({ extended: true, limit: '10mb' }));

  app.useStaticAssets(join(__dirname, '..', 'uploads/users'), {
    prefix: '/uploads/users/',
  });

  app.setGlobalPrefix('api/v1');

  // ‚úÖ VALIDATION SIMPLIFI√âE
  app.useGlobalPipes(
    new ValidationPipe({
      transform: true,
      whitelist: false,
      forbidNonWhitelisted: false,
    }),
  );

  await app.listen(3000);
}
bootstrap();
